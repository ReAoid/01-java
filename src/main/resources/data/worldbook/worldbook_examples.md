# 世界书JSON文件示例说明

## 1. manual_worldbook.json（手动配置世界书）

### 用途
- 由管理员或开发者手动配置的知识库条目
- 包含系统级的通用知识和行为准则
- 对所有用户和会话都生效

### 特点
- **永久性**：不会被自动删除或修改
- **通用性**：适用于所有用户
- **高质量**：经过精心设计和测试
- **重要性高**：通常importance值较高（5-10）

### 示例条目解析

```json
{
  "entryId": "manual_1732363200000_001",           // 唯一标识符
  "title": "创作偏好指导",                          // 条目标题
  "content": "用户在创作诗歌时...",                 // 具体指导内容
  "type": "manual",                               // 类型标识
  "keywords": ["诗", "诗歌", "创作", "写诗"],      // 触发关键词
  "importance": 7,                                // 重要性评分(1-10)
  "relevanceThreshold": 0.2,                     // 相关性阈值(越低越容易触发)
  "sessionId": null                               // 手动条目无会话限制
}
```

### 触发机制
当用户输入包含keywords中的关键词时，如果相关性评分超过relevanceThreshold，该条目就会被激活并添加到系统消息中。

## 2. extracted_worldbook.json（自动提取世界书）

### 用途
- 从用户对话中自动提取的个人信息
- 记录用户的偏好、习惯、工作背景等
- 提供个性化的对话体验

### 特点
- **动态性**：实时从对话中提取和更新
- **个性化**：针对特定用户/会话
- **自动管理**：系统自动清理过期条目
- **会话关联**：通过sessionId关联到具体会话

### 示例条目解析

```json
{
  "entryId": "extracted_1732363800000_001",
  "title": "我喜欢在晚上写代码，因为...",           // 原始用户输入的摘要
  "content": "我喜欢在晚上写代码，因为那时候比较安静，思路更清晰",
  "type": "extracted",
  "keywords": ["喜欢", "晚上", "写", "代码", "安静", "思路"],
  "importance": 6,                                // 自动计算的重要性
  "usageCount": 2,                               // 使用次数统计
  "sessionId": "session_20250923_001"           // 所属会话
}
```

### 提取规则
系统会从用户输入中提取包含以下关键词的句子：
- 个人信息：`我是`、`我叫`、`我的`
- 偏好习惯：`我喜欢`、`我不喜欢`、`偏好`、`习惯`
- 需求意愿：`我需要`、`我想要`、`我希望`
- 行为特征：`经常`、`总是`、`从不`

## 3. 工作流程

### 启动时加载
```java
@PostConstruct
public void initialize() {
    loadManualWorldBook();      // 加载手动配置
    loadExtractedWorldBook();   // 加载自动提取的内容
}
```

### 对话中检索
```java
public String retrieveRelevantContent(String sessionId, String userInput) {
    // 1. 检索手动配置的条目（全局）
    // 2. 检索当前会话的自动提取条目
    // 3. 检索其他会话的高重要性条目
    // 4. 按相关性排序，返回前3个
}
```

### 对话后提取
```java
public void extractAndAddEntry(String sessionId, String userInput) {
    // 1. 从用户输入中提取关键信息
    // 2. 创建新的extracted条目
    // 3. 保存到内存和文件
}
```

## 4. 配置说明

### 重要性评分 (importance)
- **1-3**：低重要性，个人琐碎信息
- **4-6**：中等重要性，一般偏好和习惯
- **7-8**：高重要性，重要的个人信息和工作相关
- **9-10**：极高重要性，核心身份信息

### 相关性阈值 (relevanceThreshold)
- **0.1-0.2**：很容易触发，适合重要的通用规则
- **0.3-0.4**：中等触发难度，适合一般性指导
- **0.5-0.7**：较难触发，适合特定场景的专业知识

### 使用统计
- **usageCount**：记录条目被使用的次数
- 系统会根据使用频率调整条目的重要性

## 5. 维护建议

### 手动世界书
- 定期审查和更新内容
- 添加新的通用知识和规则
- 调整关键词和阈值以优化触发效果

### 自动提取世界书
- 系统自动维护，无需手动干预
- 可以通过日志监控提取效果
- 必要时可以手动清理或调整特定条目

这个世界书系统将大大提升AI对话的个性化程度和上下文理解能力！
